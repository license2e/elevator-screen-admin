// Generated by CoffeeScript 1.6.3
(function(App, $, window) {
  App.feed = {
    form_add_feed: function() {
      $('#feed-add-form').on('submit', function(e) {
        var $this;
        e.preventDefault();
        $this = $(this);
        $.ajax({
          type: $this.attr('method'),
          data: $this.serialize(),
          url: $this.attr('action'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.id) {
            window.location.href = '/feed/';
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    delete_feed: function() {
      $('.feed-delete').on('click', function(e) {
        var $this, id;
        e.preventDefault();
        $this = $(this);
        id = $this.attr('id');
        $.ajax({
          type: 'DELETE',
          data: {
            _csrf: $('#token_csrf').val()
          },
          url: $this.attr('href'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.feed_id) {
            $.msgGrowl({
              type: 'success',
              title: 'Success',
              text: 'Successfully deleted the feed item!'
            });
            $('#' + id.replace('delete', 'row')).fadeOut('slow', function() {
              return $(this).remove();
            });
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    init: function() {
      if ($('#feed-add-form').length > 0) {
        this.form_add_feed();
      }
      if ($('.feed-delete').length > 0) {
        this.delete_feed();
      }
      return true;
    }
  };
  return true;
})(App, jQuery, window);
