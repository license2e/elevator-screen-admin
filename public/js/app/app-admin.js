// Generated by CoffeeScript 1.6.3
(function(App, $, window) {
  App.admin = {
    form_edit_user: function() {
      $('#user-edit-form').on('submit', function(e) {
        var $this;
        e.preventDefault();
        $this = $(this);
        $.ajax({
          type: $this.attr('method'),
          data: $this.serialize(),
          url: $this.attr('action'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.id) {
            window.location.href = '/';
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    form_add_user: function() {
      $('#user-add-form').on('submit', function(e) {
        var $this;
        e.preventDefault();
        $this = $(this);
        $.ajax({
          type: $this.attr('method'),
          data: $this.serialize(),
          url: $this.attr('action'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.id) {
            window.location.href = '/admin/user/';
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    form_enable_debug: function() {
      $('#debug-enable-form').on('submit', function(e) {
        var $this;
        e.preventDefault();
        $this = $(this);
        $.ajax({
          type: $this.attr('method'),
          data: $this.serialize(),
          url: $this.attr('action'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.id) {
            $.msgGrowl({
              type: 'success',
              title: 'Success',
              text: 'Successfully updated the debug mode!'
            });
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    disable_user: function() {
      $('.user-disable').on('click', function(e) {
        var $this, id;
        e.preventDefault();
        $this = $(this);
        id = $this.attr('id');
        $.ajax({
          type: 'DELETE',
          data: {
            _csrf: $('#token_csrf').val()
          },
          url: $this.attr('href'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.user_id) {
            $.msgGrowl({
              type: 'success',
              title: 'Success',
              text: 'Successfully disabled the user!'
            });
            $('#' + id.replace("disable", "status")).html('<em class="disabled">Disable</em>');
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    enable_user: function() {
      $('.user-enable').on('click', function(e) {
        var $this, id;
        e.preventDefault();
        $this = $(this);
        id = $this.attr('id');
        $.ajax({
          type: 'PUT',
          data: {
            _csrf: $('#token_csrf').val()
          },
          url: $this.attr('href'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.user_id) {
            $.msgGrowl({
              type: 'success',
              title: 'Success',
              text: 'Successfully enabled the user!'
            });
            $('#' + id.replace("enable", "status")).html('<em class="active">Active</em>');
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    init: function() {
      if ($('#user-edit-form').length > 0) {
        this.form_edit_user();
      }
      if ($('#user-add-form').length > 0) {
        this.form_add_user();
      }
      if ($('.user-disable').length > 0) {
        this.disable_user();
      }
      if ($('.user-enable').length > 0) {
        this.enable_user();
      }
      if ($('#debug-enable-form').length > 0) {
        this.form_enable_debug();
      }
      return true;
    }
  };
  return true;
})(App, jQuery, window);
