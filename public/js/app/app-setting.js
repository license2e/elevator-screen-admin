// Generated by CoffeeScript 1.6.3
(function(App, $, window) {
  App.setting = {
    form_setting_feed: function() {
      $('.setting-edit-form').on('submit', function(e) {
        var $this;
        e.preventDefault();
        $this = $(this);
        $.ajax({
          type: $this.attr('method'),
          data: $this.serialize(),
          url: $this.attr('action'),
          dataType: 'json'
        }).done(function(data) {
          if (data.error) {
            $.msgGrowl({
              type: 'error',
              title: 'Error',
              text: data.error
            });
            true;
          } else if (data.id) {
            window.location.href = '/';
          }
          return true;
        }).fail(function(jqXHR, data) {
          $.msgGrowl({
            type: 'error',
            title: 'Error',
            text: 'An error has occurred, please try again!'
          });
          return false;
        });
        return false;
      });
      return true;
    },
    get_location: function() {
      var $setting_lat, $setting_long;
      if (navigator.geolocation) {
        $setting_lat = $('#setting-lat');
        $setting_long = $('#setting-long');
        navigator.geolocation.getCurrentPosition(function(position) {
          $setting_lat.val(position.coords.latitude);
          $setting_long.val(position.coords.longitude);
          return true;
        });
        true;
      } else {

      }
      return true;
    },
    gmap_setup: function() {
      var script;
      script = window.document.createElement("script");
      script.type = "text/javascript";
      script.src = "http://maps.googleapis.com/maps/api/js?key=AIzaSyCDuBjykEB4QNpYG2NSgcZYULsMEsR5HXk&sensor=true&v=3&callback=App.setting.form_setting_forecast";
      window.document.body.appendChild(script);
      return true;
    },
    form_setting_forecast: function() {
      var $setting_lat, $setting_long;
      $setting_lat = $('#setting-lat');
      $setting_long = $('#setting-long');
      /*
      $forecast_map = $ '#setting-forecast-map'
      google.maps.visualRefresh = true
      map_options =
        center: new google.maps.LatLng 37.037778, -95.626389
        zoom: 4
        mapTypeId: google.maps.MapTypeId.ROADMAP
      map = new google.maps.Map $forecast_map[0], map_options
      
      pos = new google.maps.LatLng position.coords.latitude, position.coords.longitude
      map.panTo pos
      map.setZoom 13
      marker = new google.maps.Marker
        position: pos
        map: map
        draggable: true
      google.maps.event.addListener marker, 'dragend', ()->
        map.panTo marker.getPosition()
      true
      */

      if ($setting_lat.val() === '' || $setting_long.val() === '') {
        this.get_location();
      }
      return true;
    },
    form_location_refresh: function() {
      $('#setting-loc-refresh').on('click', function(e) {
        e.preventDefault();
        App.setting.get_location();
        return false;
      });
      return true;
    },
    init: function() {
      if ($('.setting-edit-form').length > 0) {
        this.form_setting_feed();
      }
      if ($('#setting-forecast').length > 0) {
        this.form_setting_forecast();
      }
      if ($('#setting-loc-refresh').length > 0) {
        this.form_location_refresh();
      }
      return true;
    }
  };
  return true;
})(App, jQuery, window);
